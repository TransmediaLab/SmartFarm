<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SmartFarm : Weather Editor</title>
  <script src="./blockly_compressed.js"></script>
  <script src="./blocks_compressed.js"></script>
  <script src="./javascript_compressed.js"></script>
  <script src="./msg/js/en.js"></script>
  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  <link rel="stylesheet" href="smartfarm.css" type="text/css">
  <link rel="stylesheet" href="css/weather-icons.css" type="text/css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</head>
<body onload="initialize_lsystem()">
  <h1><a href="/index">SmartFarm</a> &gt; <a href="/weather">Weather</a>
  <button onclick="lsystem_start()">START</button></h1>
  
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12">
        <div id="calendar" class="pull-left">
          <div id="calendar-month">
            Jan
          </div>
          <div id="calendar-day">
            1
          </div>
        </div>  
        <button class="btn btn-default btn-lg">
          <span class="glyphicon glyphicon-play">
        </button class="btn btn-default btn-lg">
        <button class="btn btn-default btn-lg">
          <span class="glyphicon glyphicon-pause">
        </button>
        <button class="btn btn-default btn-lg">
          <span class="glyphicon glyphicon-step-forward">
        </button>
        <button class="btn btn-default btn-lg">
          <span class="glyphicon glyphicon-retweet">
        </button>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <h2>Code Editor</h2>
        <p class="bg-info">
        <span class="glyphicon glyphicon-exclamation-sign"></span>
          You can control the weather in a SmartFarm simulation through by
          creating a <i>computer model</i> - a program built from the blocks
          provided below.
        </p>
        <div id="blocklyDiv" style="height: 480px; width: 100%;"></div>
      </div>
      <div class="col-md-6">
        <h2>Weather Report</h2>
        <p class="bg-info">
          <span class="glyphicon glyphicon-exclamation-sign"></span>
            The current weather as generated by your weather model, 
            appears below.  Beneath that you can find prior day's output -
            click to expand.
        </p>
        <div class="row">
          <div class="panel panel-default">
            <table>
              <tr>
                <td id="weather-info" rowspan=3>
                  <i class="wi wi-day-cloudy"></i>
                  16 <i class="wi wi-fahrenheit"></i>
                </td>
                <td id="weather-precipitation">Precipitation: 0 in</td>
              </tr>
              <tr>
                <td id="weather-humidity">Humdity: 51%</td>
              </tr>
              <tr>
                <td id="weather-wind">Wind: 15mph <i class="wi wi-wind-default _15-deg"></i></td>
              </tr>
            </table>
          </div>
          <ul class="list-group">
            <li class="list-group-item">
              January 1st 2014
              <i class="wi wi-day-sprinkle"></i>
              <i class="wi wi-thermometer"></i>30
              <i class="wi wi-up"></i>48</i>
              <i class="wi wi-down"></i></i>23
              <i class="wi wi-fahrenheit"></i>
              <i class="wi wi-sprinkles"></i> 20 inches
            </li>
            <li class="list-group-item">
              January 2nd 2014
              <i class="wi wi-day-sprinkle"></i>
              <i class="wi wi-thermometer"></i>30
              <i class="wi wi-up"></i>48</i>
              <i class="wi wi-down"></i></i>23
              <i class="wi wi-fahrenheit"></i>
              <i class="wi wi-sprinkles"></i> 20 inches
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  
  <table> 
    <tr>
	  <button>Run</button>
	  <button>Pause</button>
	  <button>Reset</button>
	  Slow<input id="speed" type="range"/>Fast
      <td>
        
      </td>
      <td>  
	    <div>
		
		  icon Partly Cloudy
		  High 33 Low 22
		  22
		</div>
		<ul>
		  <li><strong>Yesterday</strong> Partly Cloudy, Low 22&deg;, High 30&deg;</li>
		  <li><strong>2 Days Ago</strong> Cloudy, Low 10&deg;, High 20&deg;</li>
		</ul>
        <canvas id="canvas" width="100%" height="480" onclick="grow()"></canvas>
	  </td>
    </tr>
  </table>
  
<xml id="toolbox" style="display: none">
  <category name="Weather">
    <block type="weather_set_precipitation"></block>
	<block type="weather_get_precipitation"></block>
	<block type="weather_set_solar_radiation"></block>
	<block type="weather_get_solar_radiation"></block>
	<block type="weather_set_temperature"></block>
	<block type="weather_get_temperature"></block>
	<block type="weather_set_wind_speed"></block>
	<block type="weather_get_wind_speed"></block>
  </category>
  <category name="Logic">
    <block type="controls_if"></block>
    <block type="logic_compare"></block>
    <block type="logic_operation"></block>
    <block type="logic_negate"></block>
    <block type="logic_boolean"></block>
    <block type="logic_null"></block>
    <block type="logic_ternary"></block>
  </category>
  <category name="Loops">
    <block type="controls_repeat_ext">
      <value name="TIMES">
        <block type="math_number">
          <field name="NUM">10</field>
        </block>
      </value>
    </block>
    <block type="controls_whileUntil"></block>
    <block type="controls_for">
      <value name="FROM">
        <block type="math_number">
          <field name="NUM">1</field>
        </block>
      </value>
      <value name="TO">
        <block type="math_number">
          <field name="NUM">10</field>
        </block>
      </value>
      <value name="BY">
        <block type="math_number">
          <field name="NUM">1</field>
        </block>
      </value>
    </block>
    <block type="controls_forEach"></block>
    <block type="controls_flow_statements"></block>
  </category>
  <category name="Math">
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="math_single"></block>
    <block type="math_trig"></block>
    <block type="math_constant"></block>
    <block type="math_number_property"></block>
    <block type="math_change">
      <value name="DELTA">
        <block type="math_number">
          <field name="NUM">1</field>
        </block>
      </value>
    </block>
    <block type="math_round"></block>
    <block type="math_on_list"></block>
    <block type="math_modulo"></block>
    <block type="math_constrain">
      <value name="LOW">
        <block type="math_number">
          <field name="NUM">1</field>
        </block>
      </value>
      <value name="HIGH">
        <block type="math_number">
          <field name="NUM">100</field>
        </block>
      </value>
    </block>
    <block type="math_random_int">
      <value name="FROM">
        <block type="math_number">
          <field name="NUM">1</field>
        </block>
      </value>
      <value name="TO">
        <block type="math_number">
          <field name="NUM">100</field>
        </block>
     </value>
    </block>
    <block type="math_random_float"></block>
  </category>
  <category name="Text">
    <block type="text"></block>
    <block type="text_join"></block>
    <block type="text_append">
      <value name="TEXT">
        <block type="text"></block>
      </value>
    </block>
    <block type="text_length"></block>
    <block type="text_isEmpty"></block>
    <block type="text_indexOf">
      <value name="VALUE">
        <block type="variables_get">
          <field name="VAR">text</field>
        </block>
      </value>
    </block>
    <block type="text_charAt">
      <value name="VALUE">
        <block type="variables_get">
          <field name="VAR">text</field>
        </block>
      </value>
    </block>
    <block type="text_getSubstring">
      <value name="STRING">
        <block type="variables_get">
          <field name="VAR">text</field>
        </block>
      </value>
    </block>
    <block type="text_changeCase"></block>
    <block type="text_trim"></block>
    <block type="text_print"></block>
    <block type="text_prompt_ext">
      <value name="TEXT">
        <block type="text"></block>
      </value>
    </block>
  </category>
  <category name="Lists">
    <block type="lists_create_empty"></block>
    <block type="lists_create_with"></block>
    <block type="lists_repeat">
      <value name="NUM">
        <block type="math_number">
          <field name="NUM">5</field>
        </block>
      </value>
    </block>
    <block type="lists_length"></block>
    <block type="lists_isEmpty"></block>
    <block type="lists_indexOf">
      <value name="VALUE">
        <block type="variables_get">
          <field name="VAR">list</field>
        </block>
      </value>
    </block>
    <block type="lists_getIndex">
      <value name="VALUE">
        <block type="variables_get">
          <field name="VAR">list</field>
        </block>
      </value>
    </block>
    <block type="lists_setIndex">
      <value name="LIST">
        <block type="variables_get">
          <field name="VAR">list</field>
        </block>
      </value>
    </block>
    <block type="lists_getSublist">
      <value name="LIST">
        <block type="variables_get">
          <field name="VAR">list</field>
        </block>
      </value>
    </block>
  </category>
  <category name="Colour">
    <block type="colour_picker"></block>
    <block type="colour_random"></block>
    <block type="colour_rgb">
      <value name="RED">
        <block type="math_number">
          <field name="NUM">100</field>
        </block>
      </value>
      <value name="GREEN">
        <block type="math_number">
          <field name="NUM">50</field>
        </block>
      </value>
      <value name="BLUE">
        <block type="math_number">
          <field name="NUM">0</field>
        </block>
      </value>
    </block>
    <block type="colour_blend">
      <value name="COLOUR1">
        <block type="colour_picker">
          <field name="COLOUR">#ff0000</field>
        </block>
      </value>
      <value name="COLOUR2">
        <block type="colour_picker">
          <field name="COLOUR">#3333ff</field>
        </block>
      </value>
      <value name="RATIO">
        <block type="math_number">
          <field name="NUM">0.5</field>
        </block>
      </value>
    </block>
  </category>
  <category name="Variables" custom="VARIABLE"></category>
  <category name="Functions" custom="PROCEDURE"></category>
</xml>

  <script>
    var lSysCode;
    var lSysRules = [['draw();', 'draw();draw();']];
    var WIDTH = 480;
    var HEIGHT = 600;
    var x = WIDTH / 2;
    var y = HEIGHT / 2;
    var heading = 0.0;
    var offSetX = 0.0; offSetY = 0.0;
    var x2, y2;
	var stack = [];
    var step = 10;
    var ctx = document.getElementById('canvas')
                      .getContext('2d');
    function initialize_lsystem() {
      Blockly.inject(document.getElementById('blocklyDiv'),
          {toolbox: document.getElementById('toolbox')});
      ctx.fillStyle="#00ff05";
      ctx.fillRect(0,0, WIDTH, HEIGHT);
      ctx.fillStyle='#000000';
    }
    function lsystem_apply_rules() {
      if (lSysCode.length == 0) return;
      alert(lSysCode);
      lSysCode = (lSysCode.split(';').map( function(c) {
                   var key = c.trim() + ';'
                   var i = 0;
                   for(;i<lSysRules.length;i++) {
                     if( lSysRules[i][0] == key ) return lSysRules[i][1];
                   }
                   return key;
                 })).join(';');
      alert(lSysCode);
    }
    function lsystem_start() {
      lSysCode = Blockly.JavaScript.workspaceToCode();
      command_js();
    }
    function draw() {
      ctx.moveTo(x,y);
      y -= step + offSetY;
      x += offSetX;
      ctx.lineTo(x,y);
      ctx.stroke();
    }
    function turn(h) {
      if(h) {
        offSetY -= 2;
        offSetX -= 2;
      }
      else {
        offSetY += 2;
        offSetX += 2;
      }
    }
    function pop() {
	  state = stack.pop();
	  x = state.x;
	  y = state.y;
	  offsetX = state.offsetX;
	  offsetY = state.offsetY;
	  /*
      x = x2;
      y = y2;
      offSetY = offSetY2;
      offSetX = offSetX2;
	  */
    }
    function push() {
	  stack.push( {
		x: x,
		y: y,
		offsetX: offSetX,
		offsetY: offSetY
	  });
	  /*
      x2 = x;
      y2 = y;
      offSetX2 = offSetX;
      offSetY2 = offSetY;
	  */
    }
    function box() {
      ctx.fillRect(WIDTH/2 - Math.random()*100, HEIGHT/2 - Math.random()*100, 5, 5); 
    }
    function grow() {
      lsystem_apply_rules();
      command_js();
    }
    function command_js() {
      try {
        eval(lSysCode);
      } catch (e) { alert('Uh-oh something went wrong!\n' + e); }
    }
  </script>
</body>
</html>
